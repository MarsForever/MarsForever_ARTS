#### IDS/IPS

IDS(Intrusion Detection System)は不正侵入検知システム
IPS(Intrusion Prevention System)は不正侵入防止システム

#### AWS Transit Gateway

AWS Transit Gateway を利用して、多数のVPCを管理することができます。AWS Transit Gateway を使用すれば、中央のゲートウェイからネットワーク上にある Amazon VPC、オンプレミスのデータセンター、リモートオフィスそれぞれに単一の接続を構築して管理するのみでよいのです。Transit Gateway がハブの役割を果たし、トラフィックがスポークのように接続されたネットワーク間をどのようにルーティングするか等をすべて制御します。
AWS Transit Gateway では統計とログが提供されます。これらは、Amazon CloudWatch や Amazon VPC フローログなどのサービスで使用されます。Amazon CloudWatch を使用して、Amazon VPC と VPN 接続間の帯域幅の使用量、パケットフロー数、パケットドロップ数を取得できます。また、AWS Transit Gateway で Amazon VPC フローログを有効にできるため、AWS Transit Gateway を使用してルーティングされた IP トラフィックに関する情報を取得できます
また、トランジットゲートウェイをファイアウォールまたは IPS（侵入防止システム）に接続したり、ネットワークのすべての入出力トラフィックを処理する単一の VPC を作成することもできます。
AWS Transit Gateway network manager は、ネットワークトポロジーの変更、ルーティングの更新、接続ステータスの更新に関する組み込みのイベント通知を提供します。
これらのイベントは CloudWatch Events を通じて配信されます。

#### Snowball 

Snowball Edge Storage Optimizedは80TB、Snowball Edge Compute Optimizedは42TBのストレージ容量があります。
Snowball はセキュリティに考慮して設計されたデバイスを使用するペタバイト規模のデータ転送ソリューションで、AWS クラウド内外に大容量データを転送できます。Snowball を使用すると、高いネットワークコスト、長時間かかる転送、セキュリティ面の懸念といった、大規模なデータ転送に関する一般的な課題を解決できます。 現在はSnowball edgeのみが利用可能であり、Snowballは利用できなくなっています。

Direct ConnectはオンプレミスとAWS間との専用線接続に利用されます。

### Solution

読み取りの多いWeb層とデータベース層のパフォーマンス向上ソリューションが求められており、ElastiCache、CloudFront、リードレプリカなどのキャッシュソリューションが選択肢として考えられます。今回のケースではWEBサーバーに読み取り処理負荷を軽減するため、配信向けのCloudFrontではなくElastiCacheを選択し、かつWEBサーバーの読み取り処理を支援するために利用するというシンプルなデータ処理になるため、RedisではなくElastiCache Memcachedの利用が最適です。またRDBの読み取り処理負荷を軽減するためにはリードレプリカを増加させる方がコスト効率も良いです。
ステートレスインスタンスを使用してELBとAutoScalingグループを設定します。Webサーバーの読み取り操作にElastiCache Memcachedを使用してCloudWatchでモニタリングを実施して、最後にRDSのリードレプリカを使用することで、予測不可能な大規模なトラフィック要求を処理できる可用性の高い柔軟な構成を達成することができます。

ステートレスまたはステートフルなインスタンスのどちらを利用するかも重要となります。ステートフルなインスタンスは、クライアントとWebサーバー間の状態または接続であるため、セッションがアクティブである限りデータベースが使用されたままになるため、分散システムには適していません。したがって、サーバーだけでなくデータベースの負荷も増加します。一方でステートレスインスタンスは分散されており、スケールイン/スケールアウトが容易です。したがって、ステートレスアプリケーションは、分散アプリケーションのパフォーマンスを向上させる傾向があります。

ElastiCache Redis はデータベース向け?

#### Amazon Route 53

Amazon Route 53 のシャッフルシャーディングと anycast ルーティングにより、DDoS 攻撃を受けていても連携してエンドユーザーがアプリケーションにアクセ スできるような機能を提供しています。Amazon Route 53 は、可用性に優れ、スケーラブルな DNS サービスで、AWS の内部または外部で実行しているインフラストラクチャにエンドユーザーをルーティングすることを念頭に設計されています。Amazon Route 53 には、シャッフルシャーディングと anycast ルーティングという、DDoS 攻撃を受けていても連携してエンドユーザーがアプリケーションにアクセスできるようにする2つの機能があります。

AWS Shield AdvancedとAWS WAFは、クラウドインフラストラクチャに最適なDDoS攻撃の緩和とレイヤー7セキュリティリスクに対する保護を提供できる2つのサービスです。

#### AWS Certificate Manager 

AWS Certificate Manager なら、証明書をすばやくリクエストして、ELB、CloudFront、Amazon API Gateway の API など ACM に統合された AWS リソースでデプロイできます。AWS Certificate Manager は、AWS のサービスとユーザーの内部接続リソースで使用するパブリックとプライベートの SSL/TLS証明書のプロビジョニング、管理、デプロイを簡単にします。SSL/TLS 証明書は、ネットワーク通信を保護し、プライベートネットワークのリソースと同様にインターネットで ウェブサイトのアイデンティティを確立するために使用されます。

#### CloudFront

コンテンツのオリジンサーバーに移動する代わりに、CloudFrontエッジキャッシュから提供されるビューアリクエストの割合を増やすことにより、パフォーマンスを改善できます。これによりCloudFrontディストリビューションのキャッシュヒット率を改善することができます。キャッシュヒット率を上げるには、オブジェクトにCache-Control max-ageディレクティブを追加するようにオリジンを設定し、max-ageの実際の最長値を指定します。 キャッシュ期間が短いほど、CloudFrontは別のリクエストをオリジンに転送して、オブジェクトが変更されたかどうかを判断し、変更された場合は最新バージョンを取得する頻度を増やすことができます。

コンテンツのオリジンサーバーに移動する代わりに、CloudFrontエッジキャッシュから提供されるビューアリクエストの割合を増やすことにより、パフォーマンスを改善できます。これによりCloudFrontディストリビューションのキャッシュヒット率を改善することができます。キャッシュヒット率を上げるには、オブジェクトにCache-Control max-ageディレクティブを追加するようにオリジンを設定し、max-ageの実際の最長値を指定します。 キャッシュ期間が短いほど、CloudFrontは別のリクエストをオリジンに転送して、オブジェクトが変更されたかどうかを判断し、変更された場合は最新バージョンを取得する頻度を増やすことができます。

コスト削減策としては、エッジロケーションでのZIP圧縮によって配信ボリュームを低下させることで、コストを最適化することができます。ビューワーがリクエストヘッダーに Accept-Encoding: gzip を含めるようのリクエストした場合は、CloudFront が自動的に特定のタイプのファイルを圧縮し圧縮ファイルを供給するように設定できます。コンテンツが圧縮されるとファイルが小さくなるため、ダウンロード時間が短縮されます。場合によっては、オリジナルの 4 分の 1 以下のサイズになることがあります。


#### インスタンス

T2およびT3インスタンスを使用して、一連のEC2インスタンスのCPUパフォーマンスのベースラインレベルを保証することができます。 T3 インスタンスは、ベースラインレベルの CPU パフォーマンスを提供する次世代のバースト可能な汎用インスタンスタイプで、いつでも必要な時間だけ CPU 使用率をバーストさせる機能を備えています。T3 インスタンスはバランスの取れたコンピューティング、メモリ、およびネットワークのリソースを提供し、使用中に一時的なスパイクが生じる中程度の CPU 使用率を持つアプリケーション向けに設計されています。


新しい EC2 インスタンスを起動する場合、EC2 サービスは、相関性のエラーを最小限に抑えるために、すべてのインスタンスが基盤となるハードウェアに分散されるようにインスタンスを配置します。プレイスメントグループを使用することで、ワークロードのニーズに対応するために独立したインスタンスのグループのプレイスメントに影響を与えることができます。この設定は先にプレイスメントグループを構成した上で、その中でインスタンスタイプとインスタンス数を決定します。

G4 インスタンスは、業界内で最も費用対効果の高い GPU インスタンスで、機械学習モデルの本番環境へのデプロイやグラフィックスを多用するアプリケーションに適しています。高機能ですがT2およびT3インスタンスよりも高価




AutoScalingグループで作成された新しいEC2インスタンスに対してSSL証明書を利用した認証が実行されている必要があります。そのためにはEC2インスタンスごとではなく、AWS ACMを利用してSSL証明書を作成し、EC2インスタンスが配置されているELBに対してSSL証明書を設定することが最適な対応となります。

AWS Certificate Manager はその他の AWS サービスと統合されているため、SSL/TLS 証明書をプロビジョニングし、Elastic Load Balancer、Amazon CloudFront ディストリビューションや Amazon API Gateway の API でデプロイできます。AWS Certificate Manager は AWS Elastic Beanstalk および (E メールでの検証を使うパブリック証明書のみを対象として) AWS CloudFormation とともに使用でき、パブリック証明書の管理を容易にし、 AWS クラウドでお使いのアプリケーションとともに使用できるようにします。AWS リソースで証明書をデプロイするには、AWS マネジメントコンソールのドロップダウンリストでデプロイする証明書を選択します。または、AWS API や AWS CLI を呼び出して、証明書をリソースに関連付けることもできます。その後、AWS Certificate Manager により、選択されたリソースに証明書がデプロイされます。


AMIとは

S3のエンドポイントを作成し、S3バケットポリシーを使用してS3バケットにアクセスできるVPCとVPCエンドポイントを指定することが必要です。VPC エンドポイントを使うことにより、EC2 から S3 へ接続する際にインターネットゲートウェイや NAT ゲートウェイが不要となりますが、このシナリオではプライベートサブネットのアプリケーションレイヤーからデータ転送するとの記載があることから、プライベートサブネット内で処理を行っていることがわかります。したがって、NATゲートウェイを必要とせずにS3エンドポイントに接続する場合でも、このEC2インスタンスの処理にはサードパーティーのソフトウェアが利用して定期的にパッチ更新が必要であるため、VPCに構成したインスタンスへの処理向けにNATゲートウェイを維持することが必要です。

Amazon S3のVPCエンドポイントは、設定が簡単で信頼性が高く、NATゲートウェイやNATインスタンスを必要としないS3への安全な接続を提供します。 VPCのプライベートサブネットで実行されているEC2インスタンスは、VPCと同じリージョンにあるS3バケット、オブジェクト、およびAPI関数へのアクセスを制御できます。 S3バケットポリシーを使用して、S3バケットにアクセスできるVPCとVPCエンドポイントを指定できます。

#### SAML 2.0 IDプロバイダー

AWS はSAML 2.0を使用した ID フェデレーションをサポートします。これは、多くの ID プロバイダー (IdP) により使用されているオープンスタンダードです。この機能はフェデレーティッドシングルサインオン (SSO) を有効にします。したがって、組織内の全員について IAM ユーザーを作成しなくても、ユーザーは AWS マネジメントコンソール にログインしたり、AWS API オペレーションを呼び出したりできるようになります。

SAML 2.0 IDプロバイダーを使用してユーザーに対して、AWSリソースへのフェデレーションアクセスを提供し、オンプレミスのシングルサインオン（SSO）エンドポイントを使用してユーザーを認証し、フェデレーションアクセスを提供する前にアクセストークンを付与することでシングルサインオンを実現することができます。


Amazon ECS Cluster Auto ScalingによるECSクラスターのオートスケーリングすることができます。この機能は、スケールアウトを高速化し信頼性を向上させて、クラスター内の空きキャパシティ管理の提供と、スケールイン時に終了されるインスタンスの自動管理を提供し、クラスターの自動スケーリングをより使いやすいものにします。

設定方法は以下の通りです。
・ECS Cluster Auto Scalingを有効にするには、Capacity Providerと呼ばれる新たな項目を設定する必要があります。1つのCapacity Providerは1つのEC2 Auto Scalingグループに関連付けられます。あるAuto ScalingグループにECS Capacity Providerを関連付け、ECSクラスターにCapacity Providerを追加すると、ECSの次の2つの新機能を用いてクラスターを自動スケールできるようになります。
・Capacity Provider Reservationという新しいメトリックに対応するスケーリングポリシーが自動的に生成され、Auto Scalingグループにアタッチされます。



#### Trusted Access

Trusted Accessを使用して、指定したAWSサービスを有効することで組織とそのアカウントでタスクを自動で実行する設定を行うことができます。これには、信頼できるサービスへのアクセス許可の付与が含まれますが、IAMユーザーまたはロールのアクセス許可には影響しません。アクセスを有効にすると、信頼できるサービスは、組織のすべてのアカウントにサービスにリンクされたロールと呼ばれるIAMロールを作成できます。そのロールには、信頼できるサービスがそのサービスのドキュメントに記載されているタスクを実行できるようにする許可ポリシーがあります。これにより、信頼できるサービスに代わって組織のアカウントで維持する設定と構成の詳細を指定できます。



#### AWS Resource Access Manager

AWS Resource Access Manager（AWS RAM）を使用すると、所有する特定のAWSリソースを他のAWSアカウントと共有できます。 AWS OrganizationsでTrusted Accessを有効にするにはAWS RAM CLIから、enable-sharing-with-aws-organizationsコマンドを使用します。したがって、オプション４が正解となります。



利用しているVPCのパブリックサブネットにAWS クライアントVPNを構成して、会計アプリの全ユーザーが利用するラックトップにOpenVPN ベースの VPN クライアントアプリケーションをインストールします。さらにプライベートサブネットを構成して、アプリケーションサーバーを移行します。

VPN接続はパブリックインターネット経由でアカウンティングアプリケーションへの安全な接続を提供するため、SSLを使用したELBなどと比較して、最適なソリューションです。AWS クライアントVPN はAWS リソースやオンプレミスネットワーク内のリソースに安全にアクセスできるようにする、クライアントベースのマネージド VPN サービスです。クライアント VPN を使用すると、OpenVPN ベースの VPN クライアントを使用して、どこからでもリソースにアクセスできます。

AWS クライアントVPN においては、クライアント VPN エンドポイントの管理者およびクライアントとやり取りする 2 つのタイプのユーザーがいます。



■管理者は、サービスの設定と設定を担当します。このプロセスには、クライアント VPN エンドポイントの作成、ターゲットネットワークの関連付け、認証ルールの設定、および追加のルート (必要な場合) の設定が含まれます。クライアント VPN エンドポイントを設定した後、管理者は クライアント VPN エンドポイント設定ファイルをダウンロードして、アクセスが必要なクライアントに配布します。クライアント VPN エンドポイント設定ファイルには、クライアント VPN エンドポイントの DNS 名と、VPN セッションを確立するために必要な証明書情報が含まれています。

■クライアントはエンドユーザーです。これは、VPN セッションを確立するために クライアント VPN エンドポイントに接続する人です。クライアントは OpenVPN ベースの VPN クライアントアプリケーションを使用して、ローカルコンピュータまたはモバイルデバイスから VPN セッションを確立します。VPN セッションが確立されたら、関連付けられているサブネットが存在する VPC のリソースに安全にアクセスできます。必要なルートと認証ルールが設定されている場合は、AWS またはオンプレミスネットワークの他のリソースにもアクセスできます。 







AWS Directory Serviceを利用して、既存のMS Active DirectoryとAWSリソース管理とを統合し、AWS Managed Microsoft AD を利用してシングルサインオンを実現することができます。

既存の AD インフラストラクチャを使用して AD 対応ワークロードを AWS クラウドに移行する場合は、AWS Managed Microsoft AD が適任です。AD の信用を使用して AWS Managed Microsoft AD を既存の AD に接続できます。つまり、AD 対応アプリケーションと AWS アプリケーションにユーザーはオンプレミス AD 認証情報でアクセスでき、そのためのユーザー、グループ、またはパスワードの同期は不要です。たとえば、ユーザーは既存の AD ユーザー名とパスワードを使用して、AWS マネジメントコンソール と Amazon WorkSpaces にサインインできます。また、AWS Managed Microsoft AD で SharePoint などの AD 対応アプリケーションを使用すると、ログインした Windows ユーザーは認証情報の再入力なし、これらのアプリケーションにアクセスできるようになります。







AD Connector を利用してもシングルサインインを実現することは可能です。Windows Server 2003 以降で実行されるドメインコントローラを VPC にプロキシすることで、AD ドメインのログイン情報で AWS の Management Console にシングルサインオン (SSO)とすることができます。しかしながら、既存の AD 対応ワークロードを AWS クラウドに移行する場合は、AWS Managed Microsoft AD が適任であり、不正解となります。



予測可能なネットワークパフォーマンスを提供する要件からAWS Direct Connectが最適な選択となります。Amazon VPCはAWS上に論理的に独立した仮想クラウドを作成する機能ですが、このVPCと既存データセンターやホームネットワークなどをIPSec VPNにて接続する、AWSハードウェアVPN接続を利用可能です。Direct Connectは、AWS ハードウェア VPN 接続と組み合わせて、IPsec で暗号化された接続を作成することができます。

安全なIPsec VPN接続を実現することや、コスト効率の良い方法で可用性を達成するためには、ハードウェア VPN を Direct Connect 接続のフェールオーバーオプションとして設定することを検討してください。VPN 接続は、ほとんどの Direct Connect 接続で利用できる帯域幅と同じレベルを提供するようには設計されていません。VPN を Direct Connect 接続のバックアップとして設定している場合、ユースケースまたはアプリケーションがより低い帯域幅を許容できることを確認してください。



AWS Security Token Service (AWS STS) を使用して、AWS リソースへのアクセスをコントロールできる一時的セキュリティ認証情報を持つ、信頼されたユーザーを作成および提供することができます。これを ユーザーを認証するためのカスタムIDブローカーを作成し、認証手続きを進めることができます。AssumeRoleはAWSリソースへのアクセスに使用できる一時的なセキュリティ認証情報のセットを返します。 これらの一時的な資格情報は、アクセスキーID、シークレットアクセスキー、およびセキュリティトークンで構成されます。 通常、AssumeRoleはアカウント内またはクロスアカウントアクセスに使用します。 したがって、オプション３が正解となります。 

GetFederationTokenではフェデレーションユーザーの一連の一時的なセキュリティ資格情報（アクセスキーID、シークレットアクセスキー、およびセキュリティトークンで構成される）を返します。IAMユーザーの長期的なセキュリティ認証情報を使用してGetFederationTokenオペレーションを呼び出す必要があります。 その結果、この呼び出しにより、サーバーベースのアプリケーションにおいて、これらの資格情報を安全に保存することができます。したがって、オプション４も正解となります。



AD ConnectorとAmazon Congitoの組合せでは ユーザーを認証するためのカスタムIDブローカーを作成し、認証手続きを進めると設定ができないため、オプション１と２は不正解です。



### 疑問

No.1
内容
Fargateにもオートスケーリング機能がありますが、実施可能性や容易性の観点から間違いです。この質問で問われているのは、既存のECSの仕組みをスケーリングさせたいというものです。そもそもFargateとEC２インスタンスは互換性があるわけではなく、ユースケースが異なるため、今のEC２起動モードからFargate起動に再構成するのは容易な対応ではありません。

疑問点
確かにfargateからec2を起動でき、操作もした記憶がある



No.2

AD Connectorとは



####################################
natゲートウェイとnatインスタンスの比較
SQS　VS  SNS ＝＞昔のblogを見る
####################################









